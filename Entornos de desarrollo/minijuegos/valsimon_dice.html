<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valsimon dice</title>
    <link rel="stylesheet" href="cabeceraMinijuego.css">
    <link rel="stylesheet" href="valsimon_dice.css">
</head>
<body>
    <div class="pagina">
        <div class="cabecera"> 
            <div class="mitadSuperior"> <!--la barra superior-->

                <h1><font size="+10">Valsimon dice</font></h1>
            
            </div>
        </div>
        <div class="cuerpo">
            <div class="mitadInstrucciones"> <!--la zona izquierda-->

                <h1>Como jugar</h1>
                <p>El cuadrado grande te dara una sucesion de colores que deberas memorizar</p>
                <p>Cuando la sucesion acabe, deberas recrearla en orden con los botones de colores</p>
                <p>Si fallas, el juego acabara y el cuadrado se pondra en granate</p>
                <h1>Empezar</h1>
                <p>Para empezar una nueva partida o reiniciar la actual, deberas pulsar el boton grande</p>

                <hr>

                <h1>Puntuacion</h1>
                <p id="puntuacion">0</p>
                <h1>Record</h1>
                <p id="record">0</p>

            </div>
            <div class="mitadJuego"> <!--la zona derecha-->

                <!--botones-->
                <div class="centradoAbajo"> <!--botones de colores-->
                    <input  type='button' id="rojo" onclick="pressButton('0')"
                    style="width:100px; height:100px; background-color: rgb(255, 0, 0); border-width: 5px; border-color: black; border-style:solid;">
                    <input  type='button' id="amarillo" onclick="pressButton('1')"
                    style="width:100px; height:100px; background-color: rgb(255, 255, 0); border-width: 5px; border-color: black; border-style:solid;">
                    <input  type='button' id="verde" onclick="pressButton('2')"
                    style="width:100px; height:100px; background-color: rgb(0, 255, 0); border-width: 5px; border-color: black; border-style:solid;">
                    <input  type='button' id="azul" onclick="pressButton('3')"
                    style="width:100px; height:100px; background-color: rgb(0, 0, 255); border-width: 5px; border-color: black; border-style:solid;">
                </div>
                <div class="centradoCentro"> <!--min-width:100px; min-height:150px; boton central-->
                    <input  type='button' id="reinicio" onclick="pressButton('4')"
                    style="background-color: rgb(255, 255, 255); border-width: 5px; border-color: black; border-style:solid;">
                </div>

                <script>
                    //variables normales
                    let colorArray = [];
                    let contadorColor;
                    let juegoActivo;
                    let indexManual;
                    let bucleAcabado = true;
                    let record = 0;
                        
                    //acortar texto
                    let colorBotonGrande = document.getElementById("reinicio").style;
                    let colorBotonRojo = document.getElementById("rojo").style;
                    let colorBotonAmarillo = document.getElementById("amarillo").style;
                    let colorBotonVerde = document.getElementById("verde").style;
                    let colorBotonAzul = document.getElementById("azul").style;
                    let textoPuntuacion = document.getElementById("puntuacion");
                    let textoRecord = document.getElementById("record");
                    
                    //sistema espera
                    var sleep = function(ms){
                        return new Promise(resolve => setTimeout(resolve, ms));
                    }

                    async function pressButton(colorPulsado) {
                        
                        //empezar partida
                        if(colorPulsado == 4 && bucleAcabado==true){
                            //console.log("empezar partida")
                            juegoActivo = true;
                            colorArray = [];
                            contadorColor = 0;
                            colorArray[contadorColor] = Math.floor(Math.random() * 4);
                            indexManual=0;
                            //bucleAcabado=true;
                        }
                                                
                        //debug
                        /*
                        console.log("debug zone");
                        console.log("el array:"+colorArray);
                        console.log("el contador:"+contadorColor);
                        console.log("el index manual:"+indexManual);
                        console.log("el detector de bucle:"+bucleAcabado);
                        console.log("");
                        */
                       //alert(document.documentElement.clientWidth+" x "+document.documentElement.clientHeight);
                        
                        if (juegoActivo==true){ //partida activa
                            if(bucleAcabado==true){ //esto es para evitar sobrecarga de click
                            bucleAcabado=false
                                if (indexManual<contadorColor){ //momento pulsar
                                    if(colorPulsado==colorArray[indexManual]) { //color acertado
                                        
                                        //cambiar color
                                        if(colorPulsado==0){
                                            colorBotonRojo.backgroundColor = "rgb(0, 0, 0)";
                                        }
                                        if(colorPulsado==1){
                                            colorBotonAmarillo.backgroundColor = "rgb(0, 0, 0)";
                                        }
                                        if(colorPulsado==2){
                                            colorBotonVerde.backgroundColor = "rgb(0, 0, 0)";
                                        }
                                        if(colorPulsado==3){
                                            colorBotonAzul.backgroundColor = "rgb(0, 0, 0)";
                                        }
                                        
                                        //reiniciar color botones
                                        await sleep(50);
                                        colorBotonRojo.backgroundColor = "rgb(255, 0, 0)";
                                        colorBotonAmarillo.backgroundColor = "rgb(255, 255, 0)";
                                        colorBotonVerde.backgroundColor = "rgb(0, 255, 0)";
                                        colorBotonAzul.backgroundColor = "rgb(0, 0, 255)";
                                        await sleep(50);
                                    } else { //color fallado

                                        //cambiar color botones
                                        colorBotonGrande.backgroundColor = "rgb(100, 0, 0)";
                                        colorBotonRojo.backgroundColor = "rgb(0, 0, 0)";
                                        colorBotonAmarillo.backgroundColor = "rgb(0, 0, 0)";
                                        colorBotonVerde.backgroundColor = "rgb(0, 0, 0)";
                                        colorBotonAzul.backgroundColor = "rgb(0, 0, 0)";
                                        //parar juego
                                        juegoActivo=false;
                                    }
                                    indexManual++;
                                }
                                if(!(indexManual<contadorColor)&&juegoActivo==true){ //momento memorizar

                                    //poner colores en gris
                                    colorBotonRojo.backgroundColor = "rgb(50, 50, 50)";
                                    colorBotonAmarillo.backgroundColor = "rgb(50, 50, 50)";
                                    colorBotonVerde.backgroundColor = "rgb(50, 50, 50)";
                                    colorBotonAzul.backgroundColor = "rgb(50, 50, 50)";

                                    //aÃ±adir un color mas
                                    contadorColor++; 
                                    colorArray[contadorColor] = Math.floor(Math.random() * 4);
                                    indexManual=0;
                                    textoPuntuacion.innerHTML = contadorColor;
                                    if (record<contadorColor){
                                        record = contadorColor;
                                        textoRecord.innerHTML= record;
                                    }

                                    //sucesion de color
                                    for (i=0; i<contadorColor; i++) {
                                        switch(colorArray[i]){ 
                                        case 0:
                                            colorBotonGrande.backgroundColor = "rgb(255, 0, 0)";
                                        break;
                                        case 1:
                                            colorBotonGrande.backgroundColor = "rgb(255, 255, 0)";
                                        break;
                                        case 2:
                                            colorBotonGrande.backgroundColor = "rgb(0, 255, 0)";
                                        break;
                                        case 3:
                                            colorBotonGrande.backgroundColor = "rgb(0, 0, 255)";
                                        break;
                                        }
                                        await sleep(700);
                                            colorBotonGrande.backgroundColor = "rgb(0, 0, 0)";
                                        await sleep(100);
                                    }

                                    //reiniciar color botones
                                    colorBotonGrande.backgroundColor = "rgb(50, 50, 50)";
                                    colorBotonRojo.backgroundColor = "rgb(255, 0, 0)";
                                    colorBotonAmarillo.backgroundColor = "rgb(255, 255, 0)";
                                    colorBotonVerde.backgroundColor = "rgb(0, 255, 0)";
                                    colorBotonAzul.backgroundColor = "rgb(0, 0, 255)";
                                }    
                            bucleAcabado=true;
                            }
                        }
                    }
                </script>
            </div>
        </div>
    </div>
</body>
</html>